- name: test-integration-no-cluster
  tags:
    - integration
  command: >
    snakemake
    --use-singularity
    --singularity-prefix /tmp/singularity
    --singularity-args ' --cleanenv --bind /tmp'
    --jobs 1 -w 120
    -r -p -s Snakefile
    --config
    REFERENCE=tests/data/ref.fa
    DBSNP=tests/data/database.vcf.gz
    KNOWN_SITES=tests/data/database.vcf.gz
    SAMPLE_CONFIG=tests/data/sample_config.json
  stderr:
    contains:
      - "Job counts"
      - "localrule all:"
      - "(100%) done"
    must_not_contain:
      - "rror"
  files:
   - path: "micro/vcf/micro.vcf.gz"
     contains:
             - "chrM\t152\t.\tT\tC\t3960.77\t."
             - "GT:AD:DP:GQ:PL\t1/1:0,130:130:99:3989,388,0"

             - "chrM\t263\t.\tA\tG\t3233.06\t."
             - "GT:AD:DP:GQ:PL\t1/1:0,108:108:99:3263,323,0"

             - "chrM\t4745\t.\tA\tG\t5655.77\t."
             - "GT:AD:DP:GQ:PGT:PID:PL\t1/1:1,133:134:99:1|1:4745_A_G:5684,404,0"

             - "chrM\t4769\t.\tA\tG\t5182.77\t."
             - "GT:AD:DP:GQ:PGT:PID:PL\t1/1:1,120:121:99:1|1:4745_A_G:5211,363,0"

             - "chrM\t16023\t.\tG\tA\t1880.77\t."
             - "GT:AD:DP:GQ:PL\t0/1:72,73:145:99:1909,0,1872"

   - path: "micro/vcf/micro.g.vcf.gz"
     contains:
             - "chrM\t1\t.\tG\t<NON_REF>\t.\t.\tEND=151\tGT:DP:GQ:MIN_DP:PL\t0/0:165:99:137:0,120,1800"

             - "chrM\t152\t.\tT\tC,<NON_REF>\t3960.77"
             - "GT:AD:DP:GQ:PL:SB\t1/1:0,130,0:130:99:3989,388,0,3989,388,3989:0,0,47,83"

             - "chrM\t16023\t.\tG\tA,<NON_REF>\t1880.77\t."
             - "GT:AD:DP:GQ:PL:SB\t0/1:72,73,0:145:99:1909,0,1872,2125,2089,4214:35,37,36,37"

             - "chrM\t16560\t.\tC\t<NON_REF>\t.\t.\tEND=16569\tGT:DP:GQ:MIN_DP:PL\t0/0:188:0:180:0,0,0"

- name: test-integration-small-scatter
  tags:
    - integration
  command: >
    snakemake
    --use-singularity
    --singularity-prefix /tmp/singularity
    --singularity-args ' --cleanenv --bind /tmp'
    --jobs 1 -w 120
    -r -p -s Snakefile
    --config
    REFERENCE=tests/data/ref.fa
    DBSNP=tests/data/database.vcf.gz
    KNOWN_SITES=tests/data/database.vcf.gz
    SAMPLE_CONFIG=tests/data/sample_config.json
    SCATTER_SIZE=1000
  stderr:
    contains:
      - "Job counts"
      - "localrule all:"
      - "(100%) done"
    must_not_contain:
      - "rror"
  files:
   - path: "scatter/scatter-0.bed"
   - path: "scatter/scatter-15.bed"
   - path: "micro/vcf/micro.vcf.gz"
     contains:
             - "chrM\t152\t.\tT\tC\t3960.77\t."
             - "GT:AD:DP:GQ:PL\t1/1:0,130:130:99:3989,388,0"

             - "chrM\t263\t.\tA\tG\t3233.06\t."
             - "GT:AD:DP:GQ:PL\t1/1:0,108:108:99:3263,323,0"

             - "chrM\t4745\t.\tA\tG\t5655.77\t."
             - "GT:AD:DP:GQ:PGT:PID:PL\t1/1:1,133:134:99:1|1:4745_A_G:5684,404,0"

             - "chrM\t4769\t.\tA\tG\t5182.77\t."
             - "GT:AD:DP:GQ:PGT:PID:PL\t1/1:1,120:121:99:1|1:4745_A_G:5211,363,0"

             - "chrM\t16023\t.\tG\tA\t1880.77\t."
             - "GT:AD:DP:GQ:PL\t0/1:72,73:145:99:1909,0,1872"

   - path: "micro/vcf/micro.g.vcf.gz"
     contains:
             - "chrM\t1\t.\tG\t<NON_REF>\t.\t.\tEND=151\tGT:DP:GQ:MIN_DP:PL\t0/0:165:99:137:0,120,1800"

             - "chrM\t152\t.\tT\tC,<NON_REF>\t3960.77"
             - "GT:AD:DP:GQ:PL:SB\t1/1:0,130,0:130:99:3989,388,0,3989,388,3989:0,0,47,83"

             - "chrM\t16023\t.\tG\tA,<NON_REF>\t1880.77\t."
             - "GT:AD:DP:GQ:PL:SB\t0/1:72,73,0:145:99:1909,0,1872,2125,2089,4214:35,37,36,37"

             - "chrM\t16560\t.\tC\t<NON_REF>\t.\t.\tEND=16569\tGT:DP:GQ:MIN_DP:PL\t0/0:188:0:180:0,0,0"
